---
pagetitle: 2-3. オペレータプロパティを活用する
subtitle: 2-3. オペレータプロパティを活用する
---

ここまでの説明で、アドオンの開発の仕方が何となくわかってきたのではないかと思います。
本節では前節のサンプルを改良し、並進移動のさせ方をオペレータプロパティから変更できるようにします。


# 作成するアドオンの仕様

* *[3Dビューポート]* スペースのメニュー *[オブジェクト]* に *[並進移動]* を追加
* *[オブジェクト]* > *[並進移動]* を実行すると、*[3Dビューポート]* スペースに表示されたオペレータプロパティに指定された *[移動軸]* と *[移動量]* にしたがって、アクティブなオブジェクトが並進移動する


## オペレータプロパティとは？

Blenderではオペレータを実行すると、オペレータに対してパラメータを設定するためのUI（本書では **オペレータプロパティ** と呼びます）がToolbarの下側に表示されます。
直前に行った操作に対し、パラメータを調節して再度オペレータを実行するときに使用します。

![](../../images/chapter_02/03_Use_Operator_Property/operator_property.png "オペレータプロパティ")

今回作成するアドオンでは、オペレータプロパティから並進移動時の移動量と移動軸を指定できるようにします。


# アドオンを作成する

[1-5節](../chapter_01/05_Install_own_Add-on.html) を参考にして以下のソースコードを入力し、ファイル名 `sample_2-3.py` で保存します。

[@include-source pattern="full" filepath="chapter_02/sample_2-3.py"]


# アドオンを使用する

## アドオンを有効化する

[1-5節](../chapter_01/05_Install_own_Add-on.html) を参考にして、作成したアドオンを有効化します。

アドオンを有効化すると、コンソールウィンドウに以下の文字列が出力されます。

```
サンプル2-3: アドオン『サンプル2-3』が有効化されました。
```

*[3Dビューポート]* スペースのメニューに *[オブジェクト]* > *[並進移動]* が追加されていることを確認します。

![](../../images/chapter_02/03_Use_Operator_Property/enable_add-on.png "メニューの追加確認")


## アドオンの機能を使用する

以下の手順に従い、作成したアドオンの機能を使います。

<div class="work"></div>

|||
|---|---|
|1|Blender起動直後に生成されるオブジェクト *[Cube]* を選択します|
|2|*[3Dビューポート]* スペースのメニュー *[オブジェクト]* > *[並進移動]* を実行すると、選択したオブジェクト *[Cube]* が並進移動します。この状態でエリア左下を見てみましょう。*[並進移動]* のラベルの下に *[移動軸]* と *[移動量]* というオペレータプロパティが追加され、数値を入力できるようになっています。<br>![](../../images/chapter_02/03_Use_Operator_Property/use_add-on_2.png "オブジェクトの並進移動 手順2")|
|3|*[移動軸]* や *[移動量]* の数値を変更してみましょう。指定した値に応じて、オブジェクトが並進移動する移動軸や移動量が変わります。また、オペレータプロパティを変更するたびにオペレータメッセージが表示されます。<br>![](../../images/chapter_02/03_Use_Operator_Property/use_add-on_3.png "オブジェクトの並進移動 手順3")|


## アドオンを無効化する

[1-5節](../chapter_01/05_Install_own_Add-on.html) を参考に、有効化したアドオンを無効化します。

アドオンが無効化されると、コンソールウィンドウに以下の文字列が出力されます。

```
サンプル2-3: アドオン『サンプル2-3』が無効化されました。
```


# ソースコードの解説

作成したアドオンのソースコードを解説します。


## オペレータプロパティの作成

オペレータプロパティから直前に実行したオペレータのパラメータを調整して再実行できるようにするためには、`bpy.props` に定義されている **プロパティクラス** を、オペレータクラスのクラス変数として定義します。

利用できるプロパティクラスは以下の通りです。

|クラス名|型|
|---|---|
|`IntProperty`|整数|
|`IntVectorProperty`|整数（グループ）|
|`FloatProperty`|浮動小数点|
|`FloatVectorProperty`|浮動小数点（グループ）|
|`StringProperty`|文字列|
|`BoolProperty`|ブーリアンBlender上ではセレクトボックスのUIとなる|
|`BoolVectorProperty`|ブーリアン（グループ）|
|`EnumProperty`|列挙Blender上ではリストボックスのUIとなる|

プロパティクラス作成時に引数を指定することで、ユーザがクラスの設定を決めることができます。
以下に代表的な引数を示しますが、クラスによって指定可能な引数が異なるため注意が必要です。

|引数|値の説明|
|---|---|
|`name`|名前|
|`description`|説明文|
|`default`|デフォルト値|
|`items`|EnumPropertyで表示する項目リスト|

今回は以下のように、`EnumProperty` クラスを用いて移動軸を、`FloatPropery` クラスを用いて移動量を指定できるようにします。

[@include-source pattern="partial" filepath="chapter_02/sample_2-3.py" block="prop_translate_object"]

引数 `name` はオペレータプロパティの名称で、サンプルプログラムではそれぞれ `"移動軸"` と `"移動量"` を指定しています。
引数 `description ` はオペレータプロパティの説明文で、マウスオーバーしたときに表示されます。
引数 `default` には、それぞれ `'X'` と `1.0` が指定されているため、デフォルトではX軸正方向に1.0だけ並進移動するようになっています。
`EnumProperty` の `items` には、選択項目のリストを渡します。
選択項目のリストは、以下の要素からなるタプルのリストです。
また、`items` には項目リストを返す関数を指定でき、リストの項目を動的に変更することができます。

|要素|要素の意味|
|---|---|
|第1要素|識別子（項目選択時に変数に設定される値）|
|第2要素|リストボックスに表示される項目名|
|第3要素|リストボックスに表示される項目の説明|

オペレータプロパティの値を変更すると、オペレータクラスの `execute` メソッドが実行されます。
`execute` メソッドの中で指定されたオペレータプロパティの値は、以下のように通常のクラス変数と同様、self変数からアクセスすることで取得します。

[@include-source pattern="partial" filepath="chapter_02/sample_2-3.py" block="access_to_prop"]

<div class="column">
本節のサンプルのように値を連続的に変更可能なオペレータプロパティを作成した場合、値が変更される度に `execute` メソッドが呼ばれます。
`execute` メソッドの処理が重い場合は、値の変更だけで時間がかかってしまうため、ユーザがオペレータプロパティによるパラメータ調整をできるようにしたい場合は、`execute` メソッドの処理を可能な限り軽くするようにしましょう。
</div>


# まとめ

事前に実行した処理に対して、ユーザがオペレータプロパティから細かい制御ができるようにするための方法を紹介しました。
本節のサンプルアドオンで紹介したオペレータプロパティ以外では、整数やブーリアンなどの異なる型もオペレータプロパティとして利用できるため、ぜひ一度試してみましょう。


## ポイント

* ユーザが直前に実行した操作に対して、オペレータプロパティからパラメータを調整して再実行できる
* オペレータクラスにプロパティクラスのクラス変数を追加することで、オペレータプロパティを作成できる
* オペレータプロパティに指定した値を変更すると、値を変更するたびにオペレータクラスの `execute` メソッドが実行される
