---
pagetitle: 2-2. 複数のオペレータクラスを登録する
subtitle: 2-2. 複数のオペレータクラスを登録する
---

[2-1節](01_Basic_of_Add-on_Development.html) ではアドオン開発の基本的な部分について説明しました。
本節では前回解説した内容を理解していることを前提に、[2-1節](01_Basic_of_Add-on_Development.html) よりも複雑なサンプルを用いて、複数のメニュー項目を追加する方法を解説します。
既に解説済みの部分は説明を省略しますので、不明な点がある場合は [2-1節](01_Basic_of_Add-on_Development.html) に戻って確認してください。


# 作成するアドオンの仕様

本節で作成するアドオンの仕様は以下の通りです。

* *[3Dビューポート]* スペースのメニュー *[オブジェクト]* に *[X軸正方向へ並進移動]* と *[X軸負方向へ並進移動]* を追加
* *[オブジェクト]* > *[X軸正方向へ並進移動]* を実行すると、アクティブなオブジェクトの大きさが2倍になる
* *[オブジェクト]* > *[X軸負方向へ並進移動]* を実行すると、アクティブなオブジェクトの大きさが1/2倍になる


# アドオンを作成する

[1-5節](../chapter_01/05_Install_own_Add-on.html) を参考にして以下のソースコードを入力し、ファイル名 `sample_2-2.py` で保存します。

[@include-source pattern="full" filepath="chapter_02/sample_2-2.py"]


# アドオンを使用する

## アドオンを有効化する

[1-5節](../chapter_01/05_Install_own_Add-on.html) を参考にして、作成したアドオンを有効化します。

アドオンが有効化されると、コンソールウィンドウに以下の文字列が出力されるはずです。

```
サンプル2-2: アドオン『サンプル2-2』が有効化されました。
```

アドオン有効化後、*[3Dビューポート]* スペースのメニューに *[オブジェクト]* > *[X軸正方向へ並進移動]* と、*[オブジェクト]* > *[X軸負方向へ並進移動]* が追加されていることを確認します。

![](../../images/chapter_02/02_Register_Multiple_Operation_Classes/enable_add-on.png "メニューの追加確認")


## アドオンの機能を使用する

以下の手順に従い、作成したアドオンの機能を使ってみます。

<div class="work"></div>

|||
|---|---|
|1|Blender起動直後に自動的に生成されているオブジェクト *[Cube]* を選択し、*[3Dビューポート]* スペースのメニュー *[オブジェクト]* > *[X軸正方向へ並進移動]* を実行します。選択したオブジェクト *[Cube]* がX軸正方向に並進移動します。<br>![](../../images/chapter_02/02_Register_Multiple_Operation_Classes/use_add-on_1.png "X軸正方向へ並進移動")<br>このとき、以下のオペレータメッセージが出力されます。<br>`サンプル2-2: 『Cube』をX軸正方向へ並進移動しました。`<br>また、コンソールウィンドウにも以下のメッセージが出力されます。<br>`サンプル2-2: オペレータ『OBJECT_OT_sample22_forward_x_object』が実行されました。`|
|2|トップバーのメニュー *[ファイル]* > *[新規]* > *[全般]* を実行したあと、*[3Dビューポート]* スペースのメニュー *[オブジェクト]* > *[X軸負方向へ並進移動]* を実行します。選択中のオブジェクト *[Cube]* がX軸負方向に並進移動します。<br>![](../../images/chapter_02/02_Register_Multiple_Operation_Classes/use_add-on_2.png "X軸負方向へ並進移動")<br>このとき、以下のオペレータメッセージが出力されます。<br>`サンプル2-2: 『Cube』をX軸負方向へ並進移動しました。`<br>また、コンソールウィンドウには以下のメッセージが出力されます。<br>`サンプル2-2: オペレータ『OBJECT_OT_sample22_backward_x_object』が実行されました。`|


## アドオンを無効化する

[1-5節](../chapter_01/05_Install_own_Add-on.html) を参考に、有効化したアドオンを無効化します。

アドオンを無効化すると、コンソールウィンドウに以下の文字列が出力されます。

```
サンプル2-2: アドオン『サンプル2-2』が無効化されました。
```


# ソースコードの解説

アドオンの動作を確認したところで、次にソースコードの解説をします。
ここでは、前節で説明した内容から新しく追加された部分について説明します。


## 複数のオペレータクラスの定義

本節で新たに加わった処理の1つとして、複数のオペレータクラスを定義する処理があります。

1つのファイルに複数のオペレータの処理を定義するためには、作りたいオペレータの数だけオペレータクラスを定義する必要があります。
本節のサンプルでは、X軸正方向へのオブジェクト並進移動と、負方向へのオブジェクト並進移動の2つのオペレータのために、2つのオペレータクラスを以下のように作成しました。

[@include-source pattern="partial" filepath="chapter_02/sample_2-2.py" block="op_forward_object"]

[@include-source pattern="partial" filepath="chapter_02/sample_2-2.py" block="op_backward_object"]

`bl_idname` はオペレータクラスごとに固有の文字列を指定する必要があるため、重複しないように気をつけてください。
重複しないようにするための方法は、のちほど紹介します。


## オペレータメッセージの出力

オペレータクラスの `execute` メソッドの処理の中には、メニューが実行されたときにオペレータメッセージを出力する処理が含まれています。

ここでは、`SAMPLE22_OT_ForwardXObject` クラスの `execute` メソッド内に定義されている、オペレータメッセージを出力する処理について説明します。

[@include-source pattern="partial" filepath="chapter_02/sample_2-2.py" block="execute_forward_object"]

`execute` メソッドに渡されてくる引数については、[2-1節](01_Basic_of_Add-on_Development.html) で説明しましたので、引数の詳細についての説明はここでは省略します。
引数 `context` から、現在のコンテキスト（実行状態）を取得することができます。

現在選択されているオブジェクトである `context.active_object` を `active_obj` に一度保存し、`active_obj.location`  の第1要素に `1.0` を加えることで、オブジェクトをX軸正方向に並進移動します。

そのあと `self.report` メソッドを用いて、オペレータを実行したあとに、ユーザに対してオブジェクトを並進移動させたことがわかるようなオペレータメッセージを出力します。
ここで、`execute` メソッドの引数である `self` は、オペレータクラスのインスタンスです。

`self.report` メソッドに指定する必要のある引数を以下に示します。


|引数|値の型|値の説明|
|---|---|---|
|第1引数|set|オペレータメッセージの種類|
|第2引数|str|オペレータメッセージ本文|

表示したいメッセージの内容に応じてメッセージの種類を指定し、オペレータメッセージを出力できます。
出力メッセージの種類には例えば以下のようなものがあります。

|種類|コンソールウィンドウ|オペレータメッセージ|利用場面|
|---|---|---|
|`{'INFO'}`|情報として表示|ハイライト表示（青色）|オペレータの成功通知やオペレータにより変化した内容の通知など、参考程度の情報をユーザへ通知したい場合|
|`{'WARNING'}`|警告として表示|ハイライト表示（橙色）|アドオンの実行条件に合わないときなど、ユーザに注意を促したい情報を通知したい場合|
|`{'ERROR'}`|エラーとして表示|ハイライト表示（赤色）|アドオンの実行に失敗したときの通知や本来起こらないはずのエラーが発生したときなど、ユーザが特に注意を払ってほしい情報を通知したい場合|
|`{'OPERATOR'}`|オペレータとして表示|表示|エラー発生時に、開発者へフィードバックするためのアドオンの内部情報を表示したい場合|

本節のサンプルでは、オブジェクトが並進移動されたことをユーザへ知らせるために `{'INFO'}` を指定し、並進移動したオブジェクト名（`active_obj.name`）も表示しています。


# bl_idnameが重複していないかを確認する

`bl_idname` は重複してはならないと説明しましたが、`bl_idname` が重複していないかを確認するためにはどのようにしたらよいのでしょうか？
すでに存在する `bl_idname` を確認したいときに役に立つのが、Pythonコンソールです。

ここではPythonコンソールを使って、本節のサンプルで追加したオペレータクラスの `bl_idname` が既存のAPIと重複していないかを実際に確認してみます。
確認対象とする `bl_idname` は `"object.sample22_forward_x_object"` とします。

Blenderのエリア構成が [1-3節](../chapter_01/03_Prepare_Add-on_development_environment.html) で紹介したような設定となっていれば、左上が [Pythonコンソール] スペースとなります。

<div class="work"></div>

|||
|---|---|
|1|設定したオペレータクラスの `bl_idname` が `bpy.ops.<オペレータクラスのbl_idname>` に登録されることを利用します。*[Pythonコンソール]* スペースに `bpy.ops.object.sample22_forward_x_` と入力してみます。入力が完了したら、WindowsやLinuxであれば *[Ctrl]* + *[Space]*、Macであれば *[control]* + *[space]* を押します。ここで単語が補完されなければ、`bl_idname` として `object.sample22_forward_x_object` が利用されていないことになり、`bl_idname` への指定が可能であることがわかります。<br>![](../../images/chapter_02/02_Register_Multiple_Operation_Classes/python_console_1.png "Pythonコンソール 使い道1")|
|2|本節で作成したアドオンを有効化したあとに、Pythonコンソールに以下を打ち込んで [Enter] キーを押します。<br>`bpy.ops.object.sample22_forward_x_object()`<br>![](../../images/chapter_02/02_Register_Multiple_Operation_Classes/python_console_2.png "Pythonコンソール 使い道 手順2")<br>*[3Dビューポート]* スペースのメニューである、*[オブジェクト]* > *[X軸正方向へ並進移動]* を実行したときと同様の効果が得られます。このようにオペレータクラスを登録すると、オペレータクラスの `bl_idname` が `bpy.ops.<オペレータクラスのbl_idname>` として登録されることがわかります。|


# まとめ

本節では、複数のオペレータクラスを作る方法やオペレータメッセージを出力する方法を紹介しました。
さらに、`bl_idname` の重複を確認するときに役立つ、Pythonコンソールの利用方法を紹介しました。


## ポイント

* オペレータを複数作るためには、作りたいオペレータの数だけオペレータクラスを定義する必要がある
* `self.report` メソッドを利用することで、オペレータメッセージを出力することができる
* 登録したオペレータクラスの `bl_idname` は `bpy.ops.<bl_idname>` に登録される
* Pythonコンソールを利用して、`bl_idname` がすでに存在しないか確認できる
